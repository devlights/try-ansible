# try-ansible
This is a repository for learning Ansible using Gitpod. (for myself)

## How to run

```sh
# This is already done in Gitpod prebuild, so you don't need to do it normally.
$ docker-compose up -d              

# Enter the container for ansible
$ docker-compose exec ansible bash

root@xxxx# ansible-playbook -i apt/install/inventry.ini apt/install/playbook.yml
```

## 参考文献

- Ansible 実践ガイド 第３版 (ISBN: 9784295007647)

## メモ

従来のオンプレミス環境におけるインフラ構築作業では、エンジニアが手動で複雑なオペレーションを実施するのが当然だった。

- ハードウェアのセットアップ
- OSのチューニング
- ミドルウェアのセットアップ

などなど

一度構築したものを保守期限が切れるまで長期的に利用し続けるというスタイルを「塩漬け状態」という。

この運用スタイルが一般的であった。(今でも普通に存在するスタイル)

クラウドの登場もあり、インフラリリースを効率よく管理するために開発されたのが、システムオペレーションの自動化ツールである。

以下を解決するためである。

- クラウドリソースのライフサイクルが短く、頻繁に変更される膨大なリソースを手作業で構成管理することが非効率
- クラウドネイティブな設計によって、特定のベンダーに依存しない、移行性の高い運用が必要になった
- インフラリソースがソフトウェアによって抽象化されたため、動的にインフラを扱えるようになった
- 頻繁にシステムの構築と破棄を繰り返しても、同じクオリティのリソース提供が求められる

この恩恵はクラウド環境でなく、オンプレミスな環境でも受けることができる。


### DevOps の 定義

参考文献では、以下のように定義している。

> ビジネスやプロジェクトを成功させるために、組織文化とツールの両面を継続的に改善することで、ビジネスアジリティを向上させ、リスクを低減する活動


#### 例

運用者は独自の自動化ツールで構築作業を行い、出来上がった仮想マシンに対して、開発者は独自の手法でアプリケーションをデプロイする。
役割や責任を分断するという意味では効果的であるが、最終的に特定の人にしか管理できない自動化を生んでしまう。
これでは組織全体のメリットが半減してしまう。
こうした課題を一つずつ可視化し、改善することがDevOpsにおける組織文化の改善。


### Infrastructure as Code (コードによるインフラ構築)

インフラリソースもアプリケーションと同様に、コードで記述された内容をもとに自動で管理しようとする仕組みを

```Infrastructure as Code``` 

と呼ぶ。

> インフラの高絵師管理をコードで記述し、ソフトウェア開発で実施されてきた開発プロセスをインフラシステム、アプリケーション、ミドルウェアのデプロイやコンフィギュレーションの管理に適用すること

上記で述べている、ソフトウェア開発のプロセスは、成果対象物のバージョン管理や、繰り返し可能なビルドやテストを意味する。

インフラリソースをコードで操作するということは、そのコード自体が「品質管理」「バージョン管理」「テスト」の対象になるということ。


### Infrastructure as Code の効果

- オペレーション工数の削減

従来、手動で行ってきた作業をコード化、自動化することにより、オペレーション工数及び納期の短縮が期待できる。

- オペレーション品質の向上

運用時に発生する障害のほとんどが単純な作業ミスであり、どのような対策を施しても人が介在する限り、完全に作業ミスを防ぐことは困難。

運用作業をコード化し、自動化することにより、オペレーション品質を均一に保つ効果が期待出来る。

- システム運用の標準の促進

自動化やバージョン管理を適切に行うことにより、システム運用のポリシーや業務標準化を形成できる。

- 作業統制の強化

作業オペレーションを自動化することにより、内部統制やセキュリティ対策面での効果が期待できる。

## Ansible とは

Ansibleは、Python製の構成管理自動化ツール。Ansibleを利用することによって、スクリプトや手動で行っていたオペレーションを自動化し、開発プロセスを効率化できる。

### 特徴

- 設定ファイルの可読性が高い（YAML形式）

Ansible では、処理を記述した設定ファイルは「YAML」形式で記述される。

YAMLの構文が理解できれば、特別なコーディングスキルがなくても、どのような処理を行っているのかを把握できる。

この可読性の高さが、DevOpsを実現するうえでとても重要な要素。

開発者と運用者の間で、「同じ言語を使い」、「同じ知識を学び」、「同じ情報を共有する」という習慣こそが、変化に柔軟な組織文化を創る。

さらに設定ファイルは「ただのテキストファイル」なので、バージョン管理した際に差分も正しく表示できる。

- エージェントレス

Ansibleは、構成管理対象のサーバ（ターゲットサーバ）に、エージェントソフトウェアをインストールする必要がない。

Ansibleが実行する処理内容は、管理サーバからSSH接続を介して安全に送信、実行される。

ターゲットサーバにはPythonがインストールされている必要があるが、現状の有名ディストリビューションは全て最初からPythonがインストールされている。

- マルチレイヤの対応

Ansible は、デフォルトの機能だけでも構成管理対象のレイヤが広い。インフラエンジニア、アプリケーションエンジニアの隔てなく利用できるツールとなっている。

## 冪等性

冪等性（べきとうせい）は、ある操作や同一の設定を、何度繰り返しても、一度行った操作は実行結果が変わらないという概念。

これは、多くの構成管理ツールで実装されている特徴であり、Ansible では各モジュールの中で実装されている。

各種プロダクトを管理する上で、この冪等性が担保されていなければ、思いも寄らない設定トラブルを引き起こしてしまう可能性がある。

冪等性が担保されているツールを利用すれば、何度処理を実行しても同じ結果が得られる。

